<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dealing with data anomalies &mdash; OSmOSE toolkit  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Explore dataset metadata" href="5_explore_metadata.html" />
    <link rel="prev" title="Segment and resample a dataset" href="3_segment_resample_dataset.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/osmose_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../getting_started.html">Getting started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../getting_started.html#quick-installation">Quick installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started.html#sample-datasets">Sample datasets</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../getting_started.html#basic-use-cases">Basic use cases</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../getting_started.html#build-segment-resample-an-osmose-dataset-and-analyze-its-metadata">Build, segment, resample an OSmOSE dataset, and analyze its metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started.html#generate-spectrograms">Generate spectrograms</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../getting_started.html#spatiotemporal-join-between-acoustics-and-auxiliary-data">Spatiotemporal join between acoustics and auxiliary data</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="index.html">Build, segment, resample an OSmOSE dataset, and analyze its metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Spectrogram/index.html">Generate spectrograms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Auxiliary/index.html">Spatiotemporal join between acoustics and auxiliary data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started.html#tutorials">Tutorials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../going_further.html">Going further</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../on_datarmor.html">On Datarmor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidocs.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OSmOSE toolkit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../getting_started.html">Getting started</a></li>
          <li class="breadcrumb-item"><a href="index.html">Build, segment, resample an OSmOSE dataset, and analyze its metadata</a></li>
      <li class="breadcrumb-item active">Dealing with data anomalies</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/gallery_basic_use_cases/Dataset/4_dealwith_anomalies.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-gallery-basic-use-cases-dataset-4-dealwith-anomalies-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="dealing-with-data-anomalies">
<span id="sphx-glr-gallery-basic-use-cases-dataset-4-dealwith-anomalies-py"></span><h1>Dealing with data anomalies<a class="headerlink" href="#dealing-with-data-anomalies" title="Link to this heading">¶</a></h1>
<p>This code will show you how to deal with anomalies in raw data or their metadata, from corrupted files to differences in sample frequency.</p>
<section id="preambule-what-is-called-an-anomaly">
<h2>Preambule : what is called an anomaly ?<a class="headerlink" href="#preambule-what-is-called-an-anomaly" title="Link to this heading">¶</a></h2>
<p>For OSmOSE, audio metadata refers to any audio information collected both from audio file header or from audio content after file reading at our dataset uploading. Audio metadata read from file header (ie <code class="xref py py-obj docutils literal notranslate"><span class="pre">read_header(audio_file)</span></code>):</p>
<ol class="arabic simple">
<li><p>filename: check filenames for consistency, especially they have to contain a unique timestamp template</p></li>
<li><p>timestamp</p></li>
<li><p>extension : check that are only .wav files are present (.WAV files represent an anomaly)</p></li>
<li><p>format</p></li>
<li><p>duration</p></li>
<li><p>sample rate</p></li>
<li><p>dutycyle (timedelta between current timestamp and previous one)</p></li>
<li><p>volume</p></li>
<li><p>sampwidth</p></li>
<li><p>number of channels (stereo or mono)</p></li>
</ol>
<p>11. subtype (eg PCM16, see rumengol)
Audio metadata extracted from audio content (ie after data = audio_f.read() )
12. min and max of sample amplitude</p>
<p>Basic scan</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># - this scan only look at audio metadata from headers (1 to 11)</span>
<span class="c1"># - run within the jupyter hub session</span>
<span class="c1"># - perform the tests 1-3 and 4</span>
</pre></div>
</div>
<p>Heavy scan</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># - it will load all audio files and collect all</span>
<span class="c1"># - run with pbs jobs</span>
<span class="c1"># - perform all tests</span>
</pre></div>
</div>
<p>Light anomaly tests</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 4. len(np.unique) &gt; 1 sur duration (round to second)</span>
<span class="c1"># 5. len(np.unique) &gt; 1 sur sample_rate</span>
<span class="c1"># 6. len(np.unique) &gt; 1 sur inter_duration (round to second)</span>
</pre></div>
</div>
<p>Strong anomaly tests</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 7. at least one file header is corrupted (ie output status of method read_header)</span>
<span class="c1"># 8. at least one wav file cannot be read (ie status of data = audio_f.read() )</span>
<span class="c1"># 9. at least one audio file contains data out of the range -1:1 (based on info 12)</span>
<span class="c1"># 10. at least one audio file extension is not supported (based on info 3)</span>
</pre></div>
</div>
<p>Strong anomaly test failing, the following operations are done:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># - interrupt upload</span>
<span class="c1"># - print the failing test(s) and the filename(s) concerned</span>
<span class="c1"># - block the use of force_upload</span>
<span class="c1"># - suggest to do a complete scan of the dataset</span>
<span class="c1"># - orient the user to the notebook «visualize and understand my audio metadata»</span>
<span class="c1"># - orient the user to the notebook «handle my badly shaped dataset »</span>
</pre></div>
</div>
<p>Light anomaly test failing, the following operations are done:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># - print the failing test(s) and the filename(s) concerned</span>
<span class="c1"># - suggest using force_upload</span>
<span class="c1"># - orient the user to the notebook «visualize and understand my audio metadata»</span>
</pre></div>
</div>
</section>
<section id="codes">
<h2>Codes<a class="headerlink" href="#codes" title="Link to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sphinx_gallery_thumbnail_path = &#39;_static/thumbnail_anomalies.png&#39;</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">OSmOSE</span> <span class="kn">import</span> <span class="n">Dataset</span>
</pre></div>
</div>
<p>Let’s build the dataset following  <a class="reference internal" href="1_build_dataset.html#sphx-glr-gallery-basic-use-cases-dataset-1-build-dataset-py"><span class="std std-ref">First time building a OSmOSE dataset</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path_osmose_dataset</span> <span class="o">=</span> <span class="s2">&quot;/home6/cazaudo/Bureau/osmose_sample_datasets/&quot;</span>
<span class="n">dataset_name</span> <span class="o">=</span> <span class="s2">&quot;Cetiroise&quot;</span>
<span class="n">campaign_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="n">gps_coordinates</span> <span class="o">=</span> <span class="p">(</span><span class="mf">48.44</span><span class="p">,</span><span class="o">-</span><span class="mf">5.05</span><span class="p">)</span>
<span class="n">depth</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">dataset_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_osmose_dataset</span><span class="p">,</span> <span class="n">campaign_name</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">),</span> <span class="n">gps_coordinates</span> <span class="o">=</span> <span class="n">gps_coordinates</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span><span class="p">)</span>
</pre></div>
</div>
<p>When trying to build this dataset, it will not work directly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">date_template</span> <span class="o">=</span> <span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S&quot;</span> <span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Scanning audio files:   0%|          | 0/5 [00:00&lt;?, ?it/s]
Scanning audio files: 100%|██████████| 5/5 [00:00&lt;00:00, 320.34it/s]


 Your dataset failed 1 anomaly test of level 1 (over 1); see details below.
  Anomalies of level 1 block dataset uploading, but anyone can force it by setting the variable `force_upload` to True.
 You can inspect your metadata saved here /home6/cazaudo/Bureau/osmose_sample_datasets/Cetiroise/data/audio/original/file_metadata.csv using the notebook  /home/datawork-osmose/osmose-datarmor/notebooks/metadata_analyzer.ipynb.

Anomalies of level 0
- Test 1 : PASSED
- Test 2 : PASSED
- Test 3 : PASSED
---------------------
Anomalies of level 1
- Test 1 : FAILED
</pre></div>
</div>
<p>The variable <code class="xref py py-obj docutils literal notranslate"><span class="pre">force_upload</span></code> allows you to upload your dataset on the platform despite detected anomalies.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">force_upload</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">dataset</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">date_template</span> <span class="o">=</span> <span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S&quot;</span> <span class="p">,</span> <span class="n">force_upload</span> <span class="o">=</span> <span class="n">force_upload</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Scanning audio files:   0%|          | 0/5 [00:00&lt;?, ?it/s]
Scanning audio files: 100%|██████████| 5/5 [00:00&lt;00:00, 399.84it/s]

 DONE ! your dataset is on OSmOSE platform !
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.858 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-gallery-basic-use-cases-dataset-4-dealwith-anomalies-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/8e9fe7e59d716001e6efcdba8e37eb46/4_dealwith_anomalies.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">4_dealwith_anomalies.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/96e06e2482a364fad7fdb718837163e0/4_dealwith_anomalies.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">4_dealwith_anomalies.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="3_segment_resample_dataset.html" class="btn btn-neutral float-left" title="Segment and resample a dataset" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="5_explore_metadata.html" class="btn btn-neutral float-right" title="Explore dataset metadata" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, OSmOSE team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>